<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D Spherical Grid Deformation</title>
    <style>
        body, html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: #1E1E2E;
            perspective: 1000px;
        }
        
        .grid-container {
            position: relative;
            width: 600px;
            height: 300px;
            border: 1px solid rgba(92, 187, 246, 0.2);
            overflow: hidden;
            background-color: rgba(24, 24, 37, 0.8);
            transform-style: preserve-3d;
        }
        
        .grid-line {
            position: absolute;
            background-color: rgba(92, 187, 246, 0.3);
            transition: transform 0.2s ease, background-color 0.2s ease;
            transform-style: preserve-3d;
        }
        
        .horizontal-line {
            width: 100%;
            height: 1px;
        }
        
        .vertical-line {
            width: 1px;
            height: 100%;
        }
        
        .grid-line.active {
            background-color: rgba(255, 95, 86, 0.6);
            box-shadow: 0 0 5px rgba(255, 95, 86, 0.3);
        }
        
        .grid-segment {
            position: absolute;
            background-color: inherit;
            transition: transform 0.2s ease, background-color 0.2s ease;
            transform-style: preserve-3d;
        }
        
        .horizontal-segment {
            height: 1px;
        }
        
        .vertical-segment {
            width: 1px;
        }
    </style>
</head>
<body>
    <div class="grid-container" id="gridContainer">
        <!-- Le linee e i segmenti verranno generati via JavaScript -->
    </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const gridContainer = document.getElementById('gridContainer');
            
            // Configurazione
            const lineSpacing = 20; // Spazio tra le linee
            const influenceRadius = 80; // Raggio di influenza del mouse
            const maxElevation = 30; // Elevazione massima in pixel (asse Z)
            const segmentsPerLine = 30; // Numero di segmenti per linea
            
            let horizontalLines = [];
            let verticalLines = [];
            let gridWidth, gridHeight;
            
            // Funzione per creare la griglia
            function createGrid() {
                // Pulisci la griglia esistente
                gridContainer.innerHTML = '';
                horizontalLines = [];
                verticalLines = [];
                
                // Ottieni le dimensioni del contenitore
                gridWidth = gridContainer.clientWidth;
                gridHeight = gridContainer.clientHeight;
                
                // Calcola il numero di linee orizzontali e verticali
                const numHorizontalLines = Math.floor(gridHeight / lineSpacing) + 1;
                const numVerticalLines = Math.floor(gridWidth / lineSpacing) + 1;
                
                // Crea le linee orizzontali e i loro segmenti
                for (let i = 0; i < numHorizontalLines; i++) {
                    const y = i * lineSpacing;
                    const lineContainer = document.createElement('div');
                    lineContainer.className = 'grid-line horizontal-line';
                    lineContainer.style.top = `${y}px`;
                    
                    const segments = [];
                    const segmentWidth = gridWidth / segmentsPerLine;
                    
                    for (let j = 0; j < segmentsPerLine; j++) {
                        const segment = document.createElement('div');
                        segment.className = 'grid-segment horizontal-segment';
                        segment.style.width = `${segmentWidth}px`;
                        segment.style.left = `${j * segmentWidth}px`;
                        segment.style.top = '0';
                        
                        lineContainer.appendChild(segment);
                        
                        segments.push({
                            element: segment,
                            x: j * segmentWidth + segmentWidth / 2,
                            y: y,
                            width: segmentWidth
                        });
                    }
                    
                    gridContainer.appendChild(lineContainer);
                    
                    horizontalLines.push({
                        element: lineContainer,
                        y: y,
                        segments: segments
                    });
                }
                
                // Crea le linee verticali e i loro segmenti
                for (let i = 0; i < numVerticalLines; i++) {
                    const x = i * lineSpacing;
                    const lineContainer = document.createElement('div');
                    lineContainer.className = 'grid-line vertical-line';
                    lineContainer.style.left = `${x}px`;
                    
                    const segments = [];
                    const segmentHeight = gridHeight / segmentsPerLine;
                    
                    for (let j = 0; j < segmentsPerLine; j++) {
                        const segment = document.createElement('div');
                        segment.className = 'grid-segment vertical-segment';
                        segment.style.height = `${segmentHeight}px`;
                        segment.style.top = `${j * segmentHeight}px`;
                        segment.style.left = '0';
                        
                        lineContainer.appendChild(segment);
                        
                        segments.push({
                            element: segment,
                            x: x,
                            y: j * segmentHeight + segmentHeight / 2,
                            height: segmentHeight
                        });
                    }
                    
                    gridContainer.appendChild(lineContainer);
                    
                    verticalLines.push({
                        element: lineContainer,
                        x: x,
                        segments: segments
                    });
                }
            }
            
            // Funzione per calcolare l'elevazione sferica
            function calculateSphericalElevation(dx, dy, distance, radius) {
                if (distance >= radius) return 0;
                
                // Formula per una superficie sferica
                // z = sqrt(r² - x² - y²) dove r è il raggio della sfera
                const normalizedDistance = distance / radius;
                const elevationFactor = Math.cos(normalizedDistance * Math.PI / 2);
                return maxElevation * elevationFactor;
            }
            
            // Funzione per deformare le linee in modo sferico
            function deformLines(mouseX, mouseY) {
                // Resetta tutte le linee
                horizontalLines.forEach(line => {
                    line.element.classList.remove('active');
                });
                
                verticalLines.forEach(line => {
                    line.element.classList.remove('active');
                });
                
                // Deforma i segmenti orizzontali
                horizontalLines.forEach(line => {
                    let isLineActive = false;
                    
                    line.segments.forEach(segment => {
                        const dx = mouseX - segment.x;
                        const dy = mouseY - segment.y;
                        const distance = Math.sqrt(dx * dx + dy * dy);
                        
                        if (distance < influenceRadius) {
                            const elevation = calculateSphericalElevation(dx, dy, distance, influenceRadius);
                            
                            // Applica la trasformazione 3D
                            segment.element.style.transform = `translateZ(${elevation}px)`;
                            segment.element.style.backgroundColor = `rgba(${255 - 163 * (1 - elevation/maxElevation)}, ${95 + 92 * (1 - elevation/maxElevation)}, ${86 + 160 * (1 - elevation/maxElevation)}, ${0.3 + 0.4 * (elevation/maxElevation)})`;
                            
                            isLineActive = true;
                        } else {
                            segment.element.style.transform = 'translateZ(0)';
                            segment.element.style.backgroundColor = '';
                        }
                    });
                    
                    if (isLineActive) {
                        line.element.classList.add('active');
                    }
                });
                
                // Deforma i segmenti verticali
                verticalLines.forEach(line => {
                    let isLineActive = false;
                    
                    line.segments.forEach(segment => {
                        const dx = mouseX - segment.x;
                        const dy = mouseY - segment.y;
                        const distance = Math.sqrt(dx * dx + dy * dy);
                        
                        if (distance < influenceRadius) {
                            const elevation = calculateSphericalElevation(dx, dy, distance, influenceRadius);
                            
                            // Applica la trasformazione 3D
                            segment.element.style.transform = `translateZ(${elevation}px)`;
                            segment.element.style.backgroundColor = `rgba(${255 - 163 * (1 - elevation/maxElevation)}, ${95 + 92 * (1 - elevation/maxElevation)}, ${86 + 160 * (1 - elevation/maxElevation)}, ${0.3 + 0.4 * (elevation/maxElevation)})`;
                            
                            isLineActive = true;
                        } else {
                            segment.element.style.transform = 'translateZ(0)';
                            segment.element.style.backgroundColor = '';
                        }
                    });
                    
                    if (isLineActive) {
                        line.element.classList.add('active');
                    }
                });
            }
            
            // Funzione per gestire il movimento del mouse
            function handleMouseMove(e) {
                const rect = gridContainer.getBoundingClientRect();
                const mouseX = e.clientX - rect.left;
                const mouseY = e.clientY - rect.top;
                
                deformLines(mouseX, mouseY);
            }
            
            // Funzione per gestire l'uscita del mouse
            function handleMouseLeave() {
                // Resetta tutti i segmenti
                horizontalLines.forEach(line => {
                    line.element.classList.remove('active');
                    line.segments.forEach(segment => {
                        segment.element.style.transform = 'translateZ(0)';
                        segment.element.style.backgroundColor = '';
                    });
                });
                
                verticalLines.forEach(line => {
                    line.element.classList.remove('active');
                    line.segments.forEach(segment => {
                        segment.element.style.transform = 'translateZ(0)';
                        segment.element.style.backgroundColor = '';
                    });
                });
            }
            
            // Crea la griglia iniziale
            createGrid();
            
            // Aggiungi event listeners
            window.addEventListener('resize', createGrid);
            gridContainer.addEventListener('mousemove', handleMouseMove);
            gridContainer.addEventListener('mouseleave', handleMouseLeave);
        });
    </script>
</body>
</html>
