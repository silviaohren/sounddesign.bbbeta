<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Magnetic Field Grid</title>
    <style>
        body, html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: #1E1E2E;
            overflow: hidden;
        }
        
        .grid-container {
            position: relative;
            width: 600px;
            height: 300px;
            border: 1px solid rgba(92, 187, 246, 0.2);
            overflow: hidden;
            background-color: rgba(24, 24, 37, 0.8);
        }
        
        .grid-line {
            position: absolute;
            background-color: rgba(92, 187, 246, 0.3);
            transition: transform 0.3s ease;
        }
        
        .horizontal-line {
            width: 100%;
            height: 1px;
            left: 0;
        }
        
        .vertical-line {
            width: 1px;
            height: 100%;
            top: 0;
        }
        
        .intersection-point {
            position: absolute;
            width: 4px;
            height: 4px;
            background-color: transparent;
            border-radius: 50%;
            transform: translate(-50%, -50%);
            pointer-events: none;
            z-index: 2;
        }
        
        .intersection-point.active {
            background-color: rgba(255, 95, 86, 0.7);
            box-shadow: 0 0 8px rgba(255, 95, 86, 0.5);
        }
    </style>
</head>
<body>
    <div class="grid-container" id="gridContainer">
        <!-- Le linee verranno generate via JavaScript -->
    </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const gridContainer = document.getElementById('gridContainer');
            
            // Configurazione
            const lineSpacing = 20; // Spazio tra le linee
            const fieldRadius = 150; // Raggio del campo magnetico
            const maxDisplacement = 15; // Spostamento massimo delle linee
            const fieldStrength = 1.5; // Forza del campo (1 = normale, >1 = pi첫 forte)
            
            let horizontalLines = [];
            let verticalLines = [];
            let intersectionPoints = [];
            let gridWidth, gridHeight;
            
            // Funzione per creare la griglia
            function createGrid() {
                // Pulisci la griglia esistente
                gridContainer.innerHTML = '';
                horizontalLines = [];
                verticalLines = [];
                intersectionPoints = [];
                
                // Ottieni le dimensioni del contenitore
                gridWidth = gridContainer.clientWidth;
                gridHeight = gridContainer.clientHeight;
                
                // Calcola il numero di linee orizzontali e verticali
                const numHorizontalLines = Math.floor(gridHeight / lineSpacing) + 1;
                const numVerticalLines = Math.floor(gridWidth / lineSpacing) + 1;
                
                // Crea le linee orizzontali
                for (let i = 0; i < numHorizontalLines; i++) {
                    const y = i * lineSpacing;
                    
                    const line = document.createElement('div');
                    line.className = 'grid-line horizontal-line';
                    line.style.top = `${y}px`;
                    
                    gridContainer.appendChild(line);
                    
                    horizontalLines.push({
                        element: line,
                        y: y,
                        originalY: y
                    });
                }
                
                // Crea le linee verticali
                for (let i = 0; i < numVerticalLines; i++) {
                    const x = i * lineSpacing;
                    
                    const line = document.createElement('div');
                    line.className = 'grid-line vertical-line';
                    line.style.left = `${x}px`;
                    
                    gridContainer.appendChild(line);
                    
                    verticalLines.push({
                        element: line,
                        x: x,
                        originalX: x
                    });
                }
                
                // Crea i punti di intersezione
                for (let i = 0; i < numHorizontalLines; i++) {
                    for (let j = 0; j < numVerticalLines; j++) {
                        const x = j * lineSpacing;
                        const y = i * lineSpacing;
                        
                        const point = document.createElement('div');
                        point.className = 'intersection-point';
                        point.style.left = `${x}px`;
                        point.style.top = `${y}px`;
                        
                        gridContainer.appendChild(point);
                        
                        intersectionPoints.push({
                            element: point,
                            x: x,
                            y: y,
                            originalX: x,
                            originalY: y
                        });
                    }
                }
            }
            
            // Funzione per calcolare l'effetto del campo magnetico
            function calculateMagneticEffect(dx, dy, distance) {
                if (distance >= fieldRadius) return { x: 0, y: 0 };
                
                // Calcola la forza del campo in base alla distanza
                // Pi첫 vicino = pi첫 forte, con una curva non lineare
                const normalizedDistance = distance / fieldRadius;
                const fieldEffect = Math.pow(1 - normalizedDistance, fieldStrength);
                
                // Calcola la direzione del campo (vettore normalizzato)
                const length = Math.sqrt(dx * dx + dy * dy);
                const dirX = dx / length;
                const dirY = dy / length;
                
                // Calcola lo spostamento
                // Usiamo una funzione sinusoidale per creare un effetto ondulatorio
                const displacement = maxDisplacement * fieldEffect;
                
                // Restituisci lo spostamento nelle direzioni x e y
                return {
                    x: dirX * displacement,
                    y: dirY * displacement
                };
            }
            
            // Funzione per applicare l'effetto del campo magnetico
            function applyMagneticField(mouseX, mouseY) {
                // Resetta tutti i punti di intersezione
                intersectionPoints.forEach(point => {
                    point.element.classList.remove('active');
                });
                
                // Calcola l'effetto del campo su ogni punto di intersezione
                intersectionPoints.forEach(point => {
                    const dx = mouseX - point.x;
                    const dy = mouseY - point.y;
                    const distance = Math.sqrt(dx * dx + dy * dy);
                    
                    if (distance < fieldRadius) {
                        const effect = calculateMagneticEffect(dx, dy, distance);
                        
                        // Applica l'effetto
                        point.currentX = point.originalX + effect.x;
                        point.currentY = point.originalY + effect.y;
                        
                        // Evidenzia i punti pi첫 influenzati
                        if (distance < fieldRadius * 0.3) {
                            point.element.classList.add('active');
                        }
                    } else {
                        point.currentX = point.originalX;
                        point.currentY = point.originalY;
                    }
                });
                
                // Deforma le linee orizzontali in base ai punti di intersezione
                horizontalLines.forEach((line, lineIndex) => {
                    // Trova tutti i punti su questa linea
                    const pointsOnLine = intersectionPoints.filter(p => 
                        Math.abs(p.originalY - line.y) < 0.1
                    );
                    
                    if (pointsOnLine.length > 0) {
                        // Crea una curva basata sui punti deformati
                        const pathPoints = pointsOnLine.map(p => 
                            `${p.currentX}px ${p.currentY}px`
                        ).join(', ');
                        
                        // Applica la deformazione usando clip-path
                        line.element.style.clipPath = `polygon(0px ${line.y}px, ${pathPoints}, ${gridWidth}px ${line.y}px)`;
                    }
                });
                
                // Deforma le linee verticali in base ai punti di intersezione
                verticalLines.forEach((line, lineIndex) => {
                    // Trova tutti i punti su questa linea
                    const pointsOnLine = intersectionPoints.filter(p => 
                        Math.abs(p.originalX - line.x) < 0.1
                    );
                    
                    if (pointsOnLine.length > 0) {
                        // Crea una curva basata sui punti deformati
                        const pathPoints = pointsOnLine.map(p => 
                            `${p.currentX}px ${p.currentY}px`
                        ).join(', ');
                        
                        // Applica la deformazione usando clip-path
                        line.element.style.clipPath = `polygon(${line.x}px 0px, ${pathPoints}, ${line.x}px ${gridHeight}px)`;
                    }
                });
            }
            
            // Funzione per gestire il movimento del mouse
            function handleMouseMove(e) {
                const rect = gridContainer.getBoundingClientRect();
                const mouseX = e.clientX - rect.left;
                const mouseY = e.clientY - rect.top;
                
                applyMagneticField(mouseX, mouseY);
            }
            
            // Funzione per gestire l'uscita del mouse
            function handleMouseLeave() {
                // Resetta tutte le linee
                horizontalLines.forEach(line => {
                    line.element.style.clipPath = '';
                });
                
                verticalLines.forEach(line => {
                    line.element.style.clipPath = '';
                });
                
                // Resetta tutti i punti
                intersectionPoints.forEach(point => {
                    point.element.classList.remove('active');
                });
            }
            
            // Crea la griglia iniziale
            createGrid();
            
            // Aggiungi event listeners
            window.addEventListener('resize', createGrid);
            gridContainer.addEventListener('mousemove', handleMouseMove);
            gridContainer.addEventListener('mouseleave', handleMouseLeave);
        });
    </script>
</body>
</html>
